# Тестовая задания №5
### Установка
Перед тем как начать установку убедитесь что у вас установлены следюшие модули в системе:
* node >= 8.5.0
* npm >= 6.9.0
* yarn >= 1.13.0 (опционально)
* PostgreSQL >= 11.3 (порт по умолчанию)

Если в ващем слуаче PostgreSQL работает в другом порту настройти файл конфига knexfile.js:
```js
---
connection: `postgres://${env.DB_USER}:${
      env.DB_PASSWORD
    }@localhost:<Ваш порт>/${env.DB_NAME}`,
---
```

Все зависимости можно установить командой:
```bash
yarn setup
```
Если вы используете пакетный менеджер **npm**:
```bash
npm install && cd client/ && npm install
```
После установки зависимостей настройти файл конфигурации **.env** следющим образом:
```
// создайте две база данных в PostgreSQL второй для тестов
DB_USER=<имя пользователя>
DB_PASSWORD=<пароль>
DB_NAME=<имя базы данных>
// воторой для запуска тестов mocha
DB_USER_TEST=<имя пользователя тестирования>
DB_PASSWORD_TEST=<пароль>
DB_NAME_TEST=<имя базы данных тестирование>

```
Миграция и посев данных в таблицу происходит с помощью пакета knex.js, команды:
```bash
// миграция
yarn migrate
// посев данных
yarn seed
// откат
yarn rollback
```
Для **npm**:
```bash
npm run migrate
npm run seed
npm run rollback
```
### Запуск
Для запуска достаточно ввести команду:
```bash
yarn start
// для npm 
npm run start
```
После запуска через несколько секунд запустится оба части приложения.
Серверная часть будет доступен по адресу [localhost:1337](http://localhost:1337/), 
клиентская чась [localhost:3000](http://localhost:3000/)

#### Тесты
Запуск тестов:
```bash
yarn server:test
// npm 
npm run server:test

```
#### API
Доступные маршруты сервера koa:

| URL              | Tип     | Описание                                                              |
| :--------------- |:-------:| :-------------------------------------------------------------------- |
| /posts           |  GET    | Возвращает все посты                                                  |
| /posts/:id       |  GET    | Возврашает один пост по **id**                                        |
| /auth/reg        |  POST   | Регистрирует и возв нового пользователя если вадидация прошло успешно |
| /auth/login      |  POST   | Логин и возвращает пользователя если валидация прошло успешно         |
| /auth/status     |  GET    | Проверят токен зарегистрированного пользователя                       |
| /user/posts      |  GET    | Возв посты текущего авторизированного пользователя                    |
| /user/posts/:id  |  GET    | Возв пост по **id** для авторизированного                             |
| /admin/users     |  GET    | Возв всех зарегистрированных пользователей, только для админа         |
| /admin/users/:id |  GET    | Возв одного пользователя по **id**, только для админа                 |

#### Стек
Front-end:
* React
* Redux
* Saga
* Material Design

Back-end:
* Koa
* JWT
* PostgreSQL
* Knex
* Objection

##### Примечание
Приложение тестировалось в системе Ubuntu 18.04.2 LTS версия.
